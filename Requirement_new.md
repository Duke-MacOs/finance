# Transaction Processing Service

基于 Spring Boot 3.x 的交易处理微服务，采用 DDD（领域驱动设计）架构模式。

## 项目特性

- **Spring Boot 3.x** - 最新的 Spring Boot 框架
- **MVC 架构** - 领域驱动设计，清晰的分层架构
- **RESTful API** - 标准的 REST 接口
- **Maven 构建** - 标准的 Maven 项目结构
- **JPA/Hibernate** - 数据持久化
- **单元测试** - 完整的测试覆盖


## 快速开始
注意：当前项目涉及前后端分离，但只做后端部分，前后端通过Rest接口交互！
上传合同后，给用户一个check box，选择当前阶段（预提摊销申请阶段、付款阶段）

### 环境要求

- Java 21
- Maven 3.6+
- PostgreSql

### 步骤1 上传合同，调用外部接口解析获得合同内容：
有一个叫‘合同列表’的前段页面可以上传合同附件（通过导入合同按钮），附件保存到项目配置文件的指定目录中，附件上传成功后：
1.1，保存到合同信息表，该表符合建表规范，并有一个字段叫‘合同附件名称’。
1.2，后端调用一个外部接口，将新导入的附件通过该接口上传到外部系统，通过该接口获得：
    1，合同总金额（totalAmount）
    2，合同开始时间（startDate）
    3，合同结束时间（endDate）
    4，税率（taxRate）
    5，乙方公司名称（verdorName）（甲方为本公司，即OCBC）
1.3，将1.2获得的合同信息保存到合同信息表，并返回该条合同信息的response给前端。该合同信息支持前端的编辑，编辑后，保存到数据库。

### 步骤2 根据步骤1产生的合同信息内容，输出支付时间/预提时间表格
预提摊销表：
预提/摊销期间    入账期间    预提/摊销金额
2025年1月       2025年1月  1000.00
2025年2月       2025年2月  1000.00
2025年3月       2025年3月  1000.00
2025年4月       2025年4月  1000.00
（要求：场景1，当前时间小于合同开始时间，合同总金额自动平均摊销到合同期间的每个月；场景2，如果当前已经在合同开始时间，则合同未开始期间的每个月摊销，分别记录到当前月份；场景3，如果当前时间大于合同结束时间，则不用摊销到每个月，记当前月份的会计分录即可）
支付时间表生成之后，用户可以对该表格的内容进行操作（不支持增删行，只支持修改），然后通过保存按钮保存到数据库。

### 步骤3 产生相应会计分录
前端页面通过合同id请求后端，后端根据步骤2的预提摊销表，生成相应的会计分录列表，先保存到数据库，并返回给前端，前端将会对会计分录进行增删改操作（提供可供查询和修改的接口）。
（场景1，2023年12月审批通过预提待摊申请，摊销期间为2024年1月-2024年3月，摊销总额为3000）
预提摊销表：
预提/摊销期间    入账期间    预提/摊销金额
2025年1月       2025年1月  1000.00
2025年2月       2025年2月  1000.00
2025年3月       2025年3月  1000.00

会计分录：
Booking Date    会计科目    ENTERED DR    ENTERED CR
2024-01-27      费用       1000.00       -
2024-01-27      应付       -             1000
2024-02-27      费用       1000.00       -
2024-02-27      应付       -             1000
2024-03-27      费用       1000.00       -
2024-03-27      应付       -             1000

（场景2，2024年2月审批通过预提待摊申请，摊销期间为2024年1月-2024年3月，摊销总额为3000）
预提摊销表：
预提/摊销期间    入账期间    预提/摊销金额
2025年1月       2025年2月  1000.00
2025年2月       2025年2月  1000.00
2025年3月       2025年3月  1000.00

会计分录：
Booking Date    会计科目    ENTERED DR    ENTERED CR
2024-02-27      费用       1000.00       -
2024-02-27      应付       -             1000
2024-02-27      费用       1000.00       -
2024-02-27      应付       -             1000
2024-03-27      费用       1000.00       -
2024-03-27      应付       -             1000

### 要求步骤2跟步骤3输出形式为List<Entity>形式交给前段，并且后端借支持对数据进行调整（修改，加行或删除行）。步骤1～3分别有一张数据库表来记录相关实体信息，要求有通用的创建时间、修改时间、创建人、修改人等字段，所有表的主键id用自增id。

### 步骤4 付款阶段
将步骤2和步骤3的数据从数据库读取出来，用户在页面填写参数1:付款金额、参数2:付款时间（默认为当天，可修改）后，根据输入参数的情况修改会计分录，以下情形1～情形2中的每个月待摊金额，都来自步骤2中用户确认的每月待摊金额。修改完之后，将会计分录保存到数据库，并返回给前端，前端可通过修改会计分录接口进行修改。
（情形1，2024年1月20日，付款获得审批，付款金额1000元，相关付款不涉及预提待摊）
无预提摊销表；
会计分录：
Booking Date    会计科目    ENTERED DR    ENTERED CR
2024-01-20      费用       1000.00       -
2024-01-20      活期存款    -             1000.00

（情形2，订单摊销期间为2024年1月-2024年6月，付款总金额为6000，相关付款涉及预提待摊）
预提摊销表：
预提/摊销期间    入账期间    预提/摊销金额
2024年1月       2024年1月  1000.00
2024年2月       2024年2月  1000.00
2024年3月       2024年3月  1000.00
2024年4月       2024年4月  1000.00
2024年5月       2024年5月  1000.00
2024年6月       2024年6月  1000.00
（情形2.1，用户于3月10号提交付款申请，付款金额2000元，并在预提待摊台账中勾选对应付款期间为1-2月，财务于2024年3月20日完成复核）
会计分录：
Booking Date    会计科目    ENTERED DR    ENTERED CR
2024-03-20      应付       1000.00       -
2024-03-20      应付       1000.00       -
2024-03-20      活期存款    -             2000.00
（情形2.2，用户于3月10号提交付款申请，付款金额2001元，并在预提待摊台账中勾选对应付款期间为1-2月，财务于2024年3月20日完成复核。因为每月待摊金额为1000，所以多出来的1块钱记在借方）
会计分录：
Booking Date    会计科目    ENTERED DR（借方）    ENTERED CR（贷方）
2024-03-20      应付       1000.00               -
2024-03-20      应付       1000.00               -
2024-03-20      费用       1. 00                 -
2024-03-20      活期存款    -                     2001.00
（情形2.3，用户于3月10号提交付款申请，付款金额1999元，并在预提待摊台账中勾选对应付款期间为1-2月，财务于2024年3月20日完成复核）
会计分录：
Booking Date    会计科目    ENTERED DR（借方）    ENTERED CR（贷方）
2024-03-20      应付       1000.00               -
2024-03-20      应付       1000.00               -
2024-03-20      费用       -                     1.00
2024-03-20      活期存款    -                     1999.00
（情形2.4，用户于3月10号提交付款申请，付款金额5999元，并在预提待摊台账中勾选对应付款期间为1-6月，财务于2024年3月20日完成复核）
会计分录：
Booking Date    会计科目    ENTERED DR（借方）    ENTERED CR（贷方）
2024-03-20      应付       1000.00               -
2024-03-20      应付       1000.00               -
2024-03-20      预付       3999.00               -
2024-03-20      活期存款    -                     5999.00
2024-03-27      应付       1000.00               -
2024-03-27      预付       -                     1000.00
2024-04-27      应付       1000.00               -
2024-04-27      预付       -                     1000.00
2024-05-27      应付       1000.00               -
2024-05-27      预付       -                     1000.00
2024-06-27      应付       1000.00               -
2024-06-27      预付       -                     999.00
2024-06-27      费用       -                     1.00
（情形2.5，用户于3月10号提交付款申请，付款金额6001元，并在预提待摊台账中勾选对应付款期间为1-6月，财务于2024年3月20日完成复核）
会计分录：
Booking Date    会计科目    ENTERED DR（借方）    ENTERED CR（贷方）
2024-03-20      应付       1000.00               -
2024-03-20      应付       1000.00               -
2024-03-20      预付       4001.00               -
2024-03-20      活期存款    -                     6001.00
2024-03-27      应付       1000.00               -
2024-03-27      预付       -                     1000.00
2024-04-27      应付       1000.00               -
2024-04-27      预付       -                     1000.00
2024-05-27      应付       1000.00               -
2024-05-27      预付       -                     1000.00
2024-06-27      应付       1000.00               -
2024-06-27      预付       -                     1000.00
2024-06-27      费用       1.00                  -
2024-06-27      预付       -                     1.00
（情形2.6，用户于3月10号提交付款申请，付款金额6000元，并在预提待摊台账中勾选对应付款期间为1-6月，财务于2024年3月20日完成复核）
会计分录：
Booking Date    会计科目    ENTERED DR（借方）    ENTERED CR（贷方）
2024-03-20      应付       1000.00               -
2024-03-20      应付       1000.00               -
2024-03-20      预付       4000.00               -
2024-03-20      活期存款    -                     6000.00
2024-03-27      应付       1000.00               -
2024-03-27      预付       -                     1000.00
2024-04-27      应付       1000.00               -
2024-04-27      预付       -                     1000.00
2024-05-27      应付       1000.00               -
2024-05-27      预付       -                     1000.00
2024-06-27      应付       1000.00               -
2024-06-27      预付       -                     1000.00


## 最后生成接口文档保存到docs/api.md
接口文档格式：
API                        Method           Description          URL
localhost:8080/api/XXX     POST             XXX                  /api/XXX  